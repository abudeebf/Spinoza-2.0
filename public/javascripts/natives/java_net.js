define(["require","exports","../java_object","../logging","../util","../enums"],function(a,b,c,d,e){function f(a){switch(a){case 1e3:return"Normal closure";case 1001:return"Endpoint is going away";case 1002:return"WebSocket protocol error";case 1003:return"Server received invalid data"}return"Unknown status code or error"}function g(){return m++,m>4194304e3&&(d.error("Out of addresses"),m=4026531840),m}function h(a){var b,c=0;for(b=3;b>=0;b--)c|=255&a[b],c<<=8;return c}function i(a){var b=g();return k[b]=a,l[a]=b,b}function j(a,b,c,d,e){var f,g=a.$ws.rQlen(),h=d>g?g:d,i=a.$ws.rQshiftBytes(h);for(f=0;h>f;f++)b.array[c++]=i[f];e(h)}var k=(d.debug,{}),l={},m=4026531840,n=function(){function a(){}return a["init()V"]=function(){},a}(),o=function(){function a(){}return a["getLocalHostName()Ljava/lang/String;"]=function(a){return a.getThreadPool().getJVM().internString("localhost")},a["lookupAllHostAddr(Ljava/lang/String;)[Ljava/net/InetAddress;"]=function(a,b,d){var e=a.getBsCl().getInitializedClass(a,"Ljava/net/Inet4Address;"),f=e.method_lookup(a,"<init>(Ljava/lang/String;I)V");a.runMethod(f,[d,i(d.jvm2js_str())],function(b,d){b?a.throwException(b):a.asyncReturn(new c.JavaArray(a.getBsCl().getInitializedClass(a,"[Ljava/net/InetAddress;"),[d]))})},a["getHostByAddr([B)Ljava/lang/String;"]=function(a,b,d){var e=l[h(d.array)];return null==e?null:c.initString(a.getBsCl(),""+e)},a["isReachable0([BI[BI)Z"]=function(){return!1},a}(),p=function(){function a(){}return a["init()V"]=function(){},a}(),q=function(){function a(){}return a["init()V"]=function(){},a}(),r=function(){function a(){}return a["isIPv6Supported()Z"]=function(){return!1},a}(),s=function(){function a(){}return a["socketCreate(Z)V"]=function(a,b){if(e.are_in_browser()){var c=b.get_field(a,"Ljava/net/SocketImpl;fd");c.set_field(a,"Ljava/io/FileDescriptor;fd",8374),b.$ws=new Websock,b.$is_shutdown=!1}else a.throwNewException("Ljava/io/IOException;","WebSockets are disabled")},a["socketConnect(Ljava/net/InetAddress;II)V"]=function(a,b,c,d,e){var g,h=c.get_field(a,"Ljava/net/InetAddress;holder"),i=h.get_field(a,"Ljava/net/InetAddress$InetAddressHolder;address"),j="ws://";if(null==k[i]){for(g=3;g>=0;g--){var l=8*g;j+=""+((i&255<<l)>>>l)+"."}j=j.substring(0,j.length-1)}else j+=k[i];j+=":"+d,a.setStatus(7);var m=0,n=function(){window.clearTimeout(m),b.$ws.on("open",function(){}),b.$ws.on("close",function(){}),b.$ws.on("error",function(){})},o=function(b){return function(c){n(),a.throwNewException("Ljava/io/IOException;",b+": "+c)}},p=function(b){return function(c){n(),a.throwNewException("Ljava/io/IOException;",b+": "+f(c.status))}};b.$ws.on("open",function(){n(),a.asyncReturn()}),b.$ws.on("close",p("Connection failed! (Closed)")),0===e&&(e=1e4),m=setTimeout(o("Connection timeout!"),e);try{b.$ws.open(j)}catch(q){o("Connection failed! (exception)")(q.message)}},a["socketBind(Ljava/net/InetAddress;I)V"]=function(a){a.throwNewException("Ljava/io/IOException;","WebSockets doesn't know how to bind")},a["socketListen(I)V"]=function(a){a.throwNewException("Ljava/io/IOException;","WebSockets doesn't know how to listen")},a["socketAccept(Ljava/net/SocketImpl;)V"]=function(a){a.throwNewException("Ljava/io/IOException;","WebSockets doesn't know how to accept")},a["socketAvailable()I"]=function(a,b){a.setStatus(7),setImmediate(function(){a.asyncReturn(b.$ws.rQlen())})},a["socketClose0(Z)V"]=function(a,b){b.$ws.close()},a["socketShutdown(I)V"]=function(a,b){b.$is_shutdown=!0},a["initProto()V"]=function(){},a["socketSetOption(IZLjava/lang/Object;)V"]=function(){},a["socketGetOption(ILjava/lang/Object;)I"]=function(){return 0},a["socketGetOption1(ILjava/lang/Object;Ljava/io/FileDescriptor;)I"]=function(){return 0},a["socketSendUrgentData(I)V"]=function(a,b,c){b.$ws.send(c)},a}(),t=function(){function a(){}return a["socketRead0(Ljava/io/FileDescriptor;[BIII)I"]=function(a,b,c,d,e,f,g){var h=b.get_field(a,"Ljava/net/SocketInputStream;impl");h.$is_shutdown===!0?a.throwNewException("Ljava/io/IOException;","Socket is shutdown."):(a.setStatus(7),setTimeout(function(){j(h,d,e,f,function(b){a.asyncReturn(b)})},g))},a["init()V"]=function(){},a}(),u=function(){function a(){}return a["socketWrite0(Ljava/io/FileDescriptor;[BII)V"]=function(a,b,c,d,e,f){var g=b.get_field(a,"Ljava/net/SocketOutputStream;impl");g.$is_shutdown===!0?a.throwNewException("Ljava/io/IOException;","Socket is shutdown."):g.$ws.get_raw_state()!==WebSocket.OPEN?a.throwNewException("Ljava/io/IOException;","Connection isn't open"):(g.$ws.send(d.array.slice(e,e+f)),a.setStatus(7),setImmediate(function(){a.asyncReturn()}))},a["init()V"]=function(){},a}();registerNatives({"java/net/Inet4Address":n,"java/net/Inet4AddressImpl":o,"java/net/Inet6Address":p,"java/net/InetAddress":q,"java/net/InetAddressImplFactory":r,"java/net/PlainSocketImpl":s,"java/net/SocketInputStream":t,"java/net/SocketOutputStream":u})});