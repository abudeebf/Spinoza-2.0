define(["require","exports","../java_object","../gLong","../util","../enums","fs","path"],function(a,b,c,d,e,f,g,h){function i(a,b){var c=function(a){var b=process.stdin.read(a);return null===b&&(b=process.stdin.read()),null!==b&&1===b.length&&0===b.readUInt8(0)&&(b=new Buffer(0)),b},d=c(a);null===d?process.stdin.once("readable",function(){var d=c(a);null===d&&(d=new Buffer(0)),b(d)}):setImmediate(function(){b(d)})}function j(a,b){g.stat(a,function(a,c){b(null!=a?null:c)})}var k=function(){function a(){}return a["encoding()Ljava/lang/String;"]=function(){return null},a["echo(Z)Z"]=function(a){return a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented."),0},a["istty()Z"]=function(){return!0},a}(),l=function(){function a(){}return a["sync()V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["initIDs()V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a}(),m=function(){function a(){}return a["open(Ljava/lang/String;)V"]=function(a,b,c){var d=c.jvm2js_str();a.setStatus(7),g.open(d,"r",function(c,e){if(null!=c)"ENOENT"===c.code?a.throwNewException("Ljava/io/FileNotFoundException;",""+d+" (No such file or directory)"):a.throwNewException("Ljava/lang/Error","Internal JVM error: "+c);else{var f=b.get_field(a,"Ljava/io/FileInputStream;fd");f.set_field(a,"Ljava/io/FileDescriptor;fd",e),b.$pos=0,a.asyncReturn()}})},a["open0(Ljava/lang/String;)V"]=function(b,c,d){a["open(Ljava/lang/String;)V"](b,c,d)},a["read0()I"]=function(b,c){a["read()I"](b,c)},a["read()I"]=function(a,b){var c=b.get_field(a,"Ljava/io/FileInputStream;fd"),d=c.get_field(a,"Ljava/io/FileDescriptor;fd");-1===d?a.throwNewException("Ljava/io/IOException;","Bad file descriptor"):0!==d?(a.setStatus(7),g.fstat(d,function(c,e){var f=new Buffer(e.size);g.read(d,f,0,1,b.$pos,function(c,d){b.$pos++,a.asyncReturn(0===d?-1:f.readUInt8(0))})})):(a.setStatus(7),i(1,function(b){a.asyncReturn(0===b.length?-1:b.readUInt8(0))}))},a["readBytes([BII)I"]=function(a,b,c,d,e){var f,h,j=b.get_field(a,"Ljava/io/FileInputStream;fd"),k=j.get_field(a,"Ljava/io/FileDescriptor;fd");-1===k?a.throwNewException("Ljava/io/IOException;","Bad file descriptor"):0!==k?(h=b.$pos,f=new Buffer(e),a.setStatus(7),g.read(k,f,0,e,h,function(g,h){var i;if(null!=g)a.asyncReturn(-1);else{for(b.$pos+=h,i=0;h>i;i++)c.array[d+i]=f.readInt8(i);a.asyncReturn(0===h&&0!==e?-1:h)}})):(a.setStatus(7),i(e,function(b){var e,f;for(f=0;f<b.length;f++)e=b.readUInt8(f),c.array[d+f]=e;a.asyncReturn(0===b.length?-1:b.length)}))},a["skip(J)J"]=function(a,b,c){var e=b.get_field(a,"Ljava/io/FileInputStream;fd"),f=e.get_field(a,"Ljava/io/FileDescriptor;fd");-1===f?a.throwNewException("Ljava/io/IOException;","Bad file descriptor"):0!==f?(a.setStatus(7),g.fstat(f,function(e,f){var g=f.size-b.$pos,h=Math.min(c.toNumber(),g);b.$pos+=h,a.asyncReturn(d.fromNumber(h),null)})):(a.setStatus(7),i(c.toNumber(),function(b){a.asyncReturn(d.fromNumber(b.length),null)}))},a["available()I"]=function(a,b){var c=b.get_field(a,"Ljava/io/FileInputStream;fd"),d=c.get_field(a,"Ljava/io/FileDescriptor;fd");if(-1===d)a.throwNewException("Ljava/io/IOException;","Bad file descriptor");else{if(0===d)return 0;a.setStatus(7),g.fstat(d,function(c,d){a.asyncReturn(d.size-b.$pos)})}},a["initIDs()V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["close0()V"]=function(a,b){var c=b.get_field(a,"Ljava/io/FileInputStream;fd"),d=c.get_field(a,"Ljava/io/FileDescriptor;fd");a.setStatus(7),g.close(d,function(b){b?a.throwNewException("Ljava/io/IOException;",b.message):(c.set_field(a,"Ljava/io/FileDescriptor;fd",-1),a.asyncReturn())})},a}(),n=function(){function a(){}return a["open(Ljava/lang/String;)V"]=function(a,b,c){a.setStatus(7),g.open(c.jvm2js_str(),"w",function(c,d){var e=b.get_field(a,"Ljava/io/FileOutputStream;fd");e.set_field(a,"Ljava/io/FileDescriptor;fd",d),b.$pos=0,a.asyncReturn()})},a["open0(Ljava/lang/String;Z)V"]=function(b,c,d){a["open(Ljava/lang/String;)V"](b,c,d)},a["openAppend(Ljava/lang/String;)V"]=function(a,b,c){a.setStatus(7),g.open(c.jvm2js_str(),"a",function(c,d){var e=b.get_field(a,"Ljava/io/FileOutputStream;fd");e.set_field(a,"Ljava/io/FileDescriptor;fd",d),g.fstat(d,function(c,d){b.$pos=d.size,a.asyncReturn()})})},a["write(I)V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["writeBytes([BII)V"]=function(a,b,c,d,f){var h,i,j;if(j=b.get_field(a,"Ljava/io/FileOutputStream;fd"),i=j.get_field(a,"Ljava/io/FileDescriptor;fd"),-1===i)a.throwNewException("Ljava/io/IOException;","Bad file descriptor");else if(1!==i&&2!==i)h=new Buffer(c.array),a.setStatus(7),g.write(i,h,d,f,b.$pos,function(c,d){b.$pos+=d,a.asyncReturn()});else{var k=e.chars2js_str(c,d,f);1===i?process.stdout.write(k):2===i&&process.stderr.write(k),e.are_in_browser()&&(a.setStatus(7),setImmediate(function(){return a.asyncReturn()}))}},a["writeBytes([BIIZ)V"]=function(b,c,d,e,f){a["writeBytes([BII)V"](b,c,d,e,f)},a["close0()V"]=function(a,b){var c=b.get_field(a,"Ljava/io/FileOutputStream;fd"),d=c.get_field(a,"Ljava/io/FileDescriptor;fd");a.setStatus(7),g.close(d,function(b){b?a.throwNewException("Ljava/io/IOException;",b.message):(c.set_field(a,"Ljava/io/FileDescriptor;fd",-1),a.asyncReturn())})},a["initIDs()V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a}(),o=function(){function a(){}return a["getFileSystem()Ljava/io/FileSystem;"]=function(a){a.setStatus(7);var b=a.getBsCl();b.initializeClass(a,"Ljava/io/UnixFileSystem;",function(b){var d=new c.JavaObject(b),e=b.method_lookup(a,"<init>()V");a.runMethod(e,[d],function(b){b?a.throwException(b):(a.getThreadPool().getJVM().registerNative("java/io/FileSystem","getFileSystem()Ljava/io/FileSystem;",function(){return d}),a.asyncReturn(d))})})},a}(),p=function(){function a(){}return a["bytesToFloats([BI[FII)V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["bytesToDoubles([BI[DII)V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["latestUserDefinedLoader()Ljava/lang/ClassLoader;"]=function(a){var b,c,d=a.getStackTrace(),e=a.getBsCl();for(b=0;b<d.length;b++)if(c=d[b].method.cls.loader,c!==e)return c.getLoaderObject();return null},a}(),q=function(){function a(){}return a["floatsToBytes([FI[BII)V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["doublesToBytes([DI[BII)V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a}(),r=function(){function a(){}return a["initNative()V"]=function(){},a["hasStaticInitializer(Ljava/lang/Class;)Z"]=function(a,b){return null!=b.$cls.get_method("<clinit>()V")},a}(),s=function(){function a(){}return a["open(Ljava/lang/String;I)V"]=function(a,b,c,d){var e,f=c.jvm2js_str();switch(d){case 1:e="r";break;case 2:e="r+";break;case 4:case 8:e="rs+"}a.setStatus(7),g.open(f,e,function(c,d){if(null!=c)a.throwNewException("Ljava/io/FileNotFoundException;","Could not open file "+f+": "+c);else{var e=b.get_field(a,"Ljava/io/RandomAccessFile;fd");e.set_field(a,"Ljava/io/FileDescriptor;fd",d),b.$pos=0,a.asyncReturn()}})},a["open0(Ljava/lang/String;I)V"]=function(b,c,d,e){a["open(Ljava/lang/String;I)V"](b,c,d,e)},a["seek0(J)V"]=function(b,c,d){a["seek(J)V"](b,c,d)},a["read()I"]=function(a){return a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented."),0},a["readBytes([BII)I"]=function(a,b,c,d,e){var f=b.get_field(a,"Ljava/io/RandomAccessFile;fd"),h=f.get_field(a,"Ljava/io/FileDescriptor;fd"),i=new Buffer(e);a.setStatus(7),g.read(h,i,0,e,b.$pos,function(f,g){var h;if(null!=f)a.throwNewException("Ljava/io/IOException;","Erorr reading file: "+f);else{for(h=0;g>h;h++)c.array[d+h]=i.readInt8(h);b.$pos+=g,a.asyncReturn(0===g&&0!==e?-1:g)}})},a["write(I)V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["writeBytes([BII)V"]=function(a,b,c,d,e){var f=b.get_field(a,"Ljava/io/RandomAccessFile;fd"),h=f.get_field(a,"Ljava/io/FileDescriptor;fd"),i=new Buffer(c.array);a.setStatus(7),g.write(h,i,d,e,b.$pos,function(c,d){b.$pos+=d,a.asyncReturn()})},a["getFilePointer()J"]=function(a,b){return d.fromNumber(b.$pos)},a["seek(J)V"]=function(a,b,c){b.$pos=c.toNumber()},a["length()J"]=function(a,b){var c=b.get_field(a,"Ljava/io/RandomAccessFile;fd"),e=c.get_field(a,"Ljava/io/FileDescriptor;fd");a.setStatus(7),g.fstat(e,function(b,c){a.asyncReturn(d.fromNumber(c.size),null)})},a["setLength(J)V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["initIDs()V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a["close0()V"]=function(a,b){var c=b.get_field(a,"Ljava/io/RandomAccessFile;fd"),d=c.get_field(a,"Ljava/io/FileDescriptor;fd");a.setStatus(7),g.close(d,function(b){b?a.throwNewException("Ljava/io/IOException;",b.message):(c.set_field(a,"Ljava/io/FileDescriptor;fd",-1),a.asyncReturn())})},a}(),t=function(){function a(){}return a["canonicalize0(Ljava/lang/String;)Ljava/lang/String;"]=function(a,b,d){var e=d.jvm2js_str();return c.initString(a.getBsCl(),h.resolve(h.normalize(e)))},a["getBooleanAttributes0(Ljava/io/File;)I"]=function(a,b,c){var d=c.get_field(a,"Ljava/io/File;path");a.setStatus(7),j(d.jvm2js_str(),function(b){a.asyncReturn(null==b?0:b.isFile()?3:b.isDirectory()?5:1)})},a["checkAccess(Ljava/io/File;I)Z"]=function(a,b,c,d){var e=c.get_field(a,"Ljava/io/File;path");a.setStatus(7),j(e.jvm2js_str(),function(b){if(null==b)a.asyncReturn(0);else{var c=d|d<<3|d<<6;a.asyncReturn((b.mode&c)>0?1:0)}})},a["getLastModifiedTime(Ljava/io/File;)J"]=function(a,b,c){var e=c.get_field(a,"Ljava/io/File;path").jvm2js_str();a.setStatus(7),j(e,function(b){null==b?a.asyncReturn(d.ZERO,null):a.asyncReturn(d.fromNumber(b.mtime.getTime()),null)})},a["getLength(Ljava/io/File;)J"]=function(a,b,c){var e=c.get_field(a,"Ljava/io/File;path");a.setStatus(7),g.stat(e.jvm2js_str(),function(b,c){a.asyncReturn(d.fromNumber(null!=b?0:c.size),null)})},a["setPermission(Ljava/io/File;IZZ)Z"]=function(a,b,c,d,e,f){var h=c.get_field(a,"Ljava/io/File;path").jvm2js_str();f?d<<=6:d|=d<<6|d<<3,e||(d=~d),a.setStatus(7),j(h,function(b){if(null==b)a.asyncReturn(0);else{var c=b.mode;d=e?c|d:c&d,g.chmod(h,d,function(b){a.asyncReturn(null!=b?0:1)})}})},a["createFileExclusively(Ljava/lang/String;Z)Z"]=function(a,b,c){var d=c.jvm2js_str();a.setStatus(7),j(d,function(b){null!=b?a.asyncReturn(0):g.open(d,"w",function(b,c){null!=b?a.throwNewException("Ljava/io/IOException;",b.message):g.close(c,function(b){null!=b?a.throwNewException("Ljava/io/IOException;",b.message):a.asyncReturn(1)})})})},a["createFileExclusively(Ljava/lang/String;)Z"]=function(b,c,d){return a["createFileExclusively(Ljava/lang/String;Z)Z"](b,c,d,0)},a["delete0(Ljava/io/File;)Z"]=function(a,b,c){var d=c.get_field(a,"Ljava/io/File;path").jvm2js_str();a.setStatus(7),j(d,function(b){null==b?a.asyncReturn(0):b.isDirectory()?g.readdir(d,function(b,c){c.length>0?a.asyncReturn(0):g.rmdir(d,function(){a.asyncReturn(1)})}):g.unlink(d,function(){a.asyncReturn(1)})})},a["list(Ljava/io/File;)[Ljava/lang/String;"]=function(a,b,d){var e=d.get_field(a,"Ljava/io/File;path"),f=a.getBsCl();a.setStatus(7),g.readdir(e.jvm2js_str(),function(b,d){a.asyncReturn(null!=b?null:new c.JavaArray(f.getInitializedClass(a,"[Ljava/lang/String;"),function(){var a,b=d.length,e=[];for(a=0;b>a;a++)e.push(c.initString(f,d[a]));return e}()))})},a["createDirectory(Ljava/io/File;)Z"]=function(a,b,c){var d=c.get_field(a,"Ljava/io/File;path").jvm2js_str();a.setStatus(7),j(d,function(b){null!=b?a.asyncReturn(0):g.mkdir(d,function(b){a.asyncReturn(null!=b?0:1)})})},a["rename0(Ljava/io/File;Ljava/io/File;)Z"]=function(a,b,c,d){var e=c.get_field(a,"Ljava/io/File;path").jvm2js_str(),f=d.get_field(a,"Ljava/io/File;path").jvm2js_str();a.setStatus(7),g.rename(e,f,function(b){a.asyncReturn(null!=b?0:1)})},a["setLastModifiedTime(Ljava/io/File;J)Z"]=function(a,b,c,d){var e=d.toNumber(),f=(new Date).getTime(),h=c.get_field(a,"Ljava/io/File;path").jvm2js_str();a.setStatus(7),g.utimes(h,f,e,function(){a.asyncReturn(1)})},a["setReadOnly(Ljava/io/File;)Z"]=function(a,b,c){var d=c.get_field(a,"Ljava/io/File;path").jvm2js_str(),e=-147;a.setStatus(7),j(d,function(b){null==b?a.asyncReturn(0):g.chmod(d,b.mode&e,function(b){a.asyncReturn(null!=b?0:1)})})},a["getSpace(Ljava/io/File;I)J"]=function(a){return a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented."),null},a["initIDs()V"]=function(a){a.throwNewException("Ljava/lang/UnsatisfiedLinkError;","Native method not implemented.")},a}();registerNatives({"java/io/Console":k,"java/io/FileDescriptor":l,"java/io/FileInputStream":m,"java/io/FileOutputStream":n,"java/io/FileSystem":o,"java/io/ObjectInputStream":p,"java/io/ObjectOutputStream":q,"java/io/ObjectStreamClass":r,"java/io/RandomAccessFile":s,"java/io/UnixFileSystem":t})});